/**
 * This is the main entry point for the application. It sets up the Express server, configures middleware, and connects to the MongoDB database. It also defines the routes for the application and starts the server.
 */
var u={};const c=require("path"),r=require("express");require("mongoose");const a=require("dotenv");require("morgan");const d=require("express-handlebars"),l=require("method-override"),t=require("passport"),p=require("express-session"),b=require("connect-mongo"),f=require("./config/db");a.config({path:"./config/config.env"});require("./config/passport")(t);f();const e=r();e.use(r.urlencoded({extended:!1}));e.use(r.json());e.use(l(function(s,n){if(s.body&&typeof s.body=="object"&&"_method"in s.body){let o=s.body._method;return delete s.body._method,o}}));const{formatDate:m,stripTags:g,truncate:h,editIcon:q,select:v}=require("./helpers/hbs");e.engine(".hbs",d({helpers:{formatDate:m,stripTags:g,truncate:h,editIcon:q,select:v},defaultLayout:"main",extname:".hbs"}));e.set("view engine",".hbs");e.use(p({secret:"keyboard cat",resave:!1,saveUninitialized:!1,store:b.create({mongoUrl:"mongodb+srv://rodrigo:Nses100@x.xlnsedo.mongodb.net/?retryWrites=true&w=majority&appName=x"})}));e.use(t.initialize());e.use(t.session());e.use(function(s,n,o){n.locals.user=s.user||null,o()});e.use(r.static(c.join(__dirname,"public")));e.use("/",require("./routes/index"));e.use("/auth",require("./routes/auth"));e.use("/stories",require("./routes/stories"));const i=u.PORT||3e3;e.listen(i,console.log(`Server running in port ${i}`));
